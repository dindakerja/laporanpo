<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Produksi & Progres Proyek</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        [contenteditable="true"]:hover {
            outline: 1px dashed #d1d5eb;
        }
        [contenteditable="true"]:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
            background-color: #f9fafb;
        }
        .progress-bar {
            height: 8px;
            border-radius: 9999px;
            background-color: #e5e7eb;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #10b981;
            transition: width 0.3s ease-in-out;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-6 flex flex-col min-h-screen">

    <div class="max-w-7xl mx-auto w-full flex-grow flex flex-col">
        <header class="text-center mb-6 relative">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Dashboard Produksi & Progres Proyek</h1>
            <p class="text-sm sm:text-base text-gray-500 mt-1">
                <span id="report-title-date" contenteditable="true">Memuat Laporan Harian...</span>
            </p>
            <p class="text-xs text-gray-400 mt-1">
                <span id="user-id-display">Memuat ID Pengguna...</span> | Terakhir diperbarui: <span id="last-updated-date">...</span>
            </p>
            <button id="edit-report-button" onclick="openFullReportEditor()" class="absolute top-0 right-0 mt-1 mr-1 px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                Edit Laporan
            </button>
        </header>

        <!-- Main content container -->
        <div class="flex flex-col md:flex-row gap-6">
            <!-- Main Content: Laporan Harian -->
            <div class="md:w-2/3 space-y-6">
                <!-- Key Metrics Section -->
                <div class="bg-white rounded-xl shadow-lg p-5">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Ringkasan Produksi Minyak</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-blue-600" id="total-prod-rtu" contenteditable="true">...</p>
                            <p class="text-sm font-medium text-blue-500 mt-1">Total Prod RTU (bbls)</p>
                            <p class="text-xs text-gray-400" id="total-prod-rtu-change" contenteditable="true">...</p>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-green-600" id="prod-rtu-aceh" contenteditable="true">...</p>
                            <p class="text-sm font-medium text-green-500 mt-1">Prod RTU-Aceh (bbls)</p>
                            <p class="text-xs text-gray-400" id="prod-rtu-aceh-change" contenteditable="true">...</p>
                        </div>
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-yellow-600" id="prod-rtu-sumut" contenteditable="true">...</p>
                            <p class="text-sm font-medium text-yellow-500 mt-1">Prod RTU-Sumut (bbls)</p>
                            <p class="text-xs text-gray-400" id="prod-rtu-sumut-change" contenteditable="true">...</p>
                        </div>
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-gray-600" id="crude-oil-stock" contenteditable="true">...</p>
                            <p class="text-sm font-medium text-gray-500 mt-1">CRUDE OIL STOCK (bbls)</p>
                        </div>
                    </div>
                    
                    <!-- New section for Gas production -->
                    <h2 class="text-xl font-bold text-gray-800 mt-6 mb-3">Ringkasan Produksi Gas</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="bg-sky-50 border border-sky-200 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-sky-600" id="prod-gas-total" contenteditable="true">...</p>
                            <p class="text-sm font-medium text-sky-500 mt-1">Prod Gas Total (Mmscfd)</p>
                            <p class="text-xs text-gray-400" id="prod-gas-total-change" contenteditable="true">...</p>
                            <p class="text-xs font-medium text-gray-500 mt-2">MTD: <span id="prod-gas-mtd" contenteditable="true">...</span></p>
                            <p class="text-xs font-medium text-gray-500">YTD: <span id="prod-gas-ytd" contenteditable="true">...</span></p>
                        </div>
                        <div class="bg-sky-50 border border-sky-200 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-sky-600" id="prod-gas-aceh" contenteditable="true">...</p>
                            <p class="text-sm font-medium text-sky-500 mt-1">Prod Gas RTU-Aceh (Mmscfd)</p>
                            <p class="text-xs text-gray-400" id="prod-gas-aceh-percent" contenteditable="true">...</p>
                            <p class="text-xs font-medium text-gray-500 mt-2">MTD: <span id="prod-gas-aceh-mtd" contenteditable="true">...</span></p>
                            <p class="text-xs font-medium text-gray-500">YTD: <span id="prod-gas-aceh-ytd" contenteditable="true">...</span></p>
                        </div>
                        <div class="bg-sky-50 border border-sky-200 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-sky-600" id="prod-gas-sumut" contenteditable="true">...</p>
                            <p class="text-sm font-medium text-sky-500 mt-1">Prod Gas RTU-Sumut (Mmscfd)</p>
                            <p class="text-xs text-gray-400" id="prod-gas-sumut-percent" contenteditable="true">...</p>
                            <p class="text-xs font-medium text-gray-500 mt-2">MTD: <span id="prod-gas-sumut-mtd" contenteditable="true">...</span></p>
                            <p class="text-xs font-medium text-gray-500">YTD: <span id="prod-gas-sumut-ytd" contenteditable="true">...</span></p>
                        </div>
                    </div>
                </div>

                <!-- Sumur Status Section -->
                <div class="bg-white rounded-xl shadow-lg p-5">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Status Sumur</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <h3 class="font-semibold text-red-600 mb-2">Sumur Low <span id="sumur-low-bbls" contenteditable="true">...</span></h3>
                            <ul class="text-sm text-gray-700 space-y-1" id="sumur-low-list" data-list-section="low"></ul>
                            <button onclick="toggleList('low')" class="text-xs text-red-400 hover:underline mt-2" data-toggle-button="low">Lihat lebih banyak...</button>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h3 class="font-semibold text-green-600 mb-2">Sumur Gain <span id="sumur-gain-bbls" contenteditable="true">...</span></h3>
                            <ul class="text-sm text-gray-700 space-y-1" id="sumur-gain-list" data-list-section="gain"></ul>
                            <button onclick="toggleList('gain')" class="text-xs text-green-400 hover:underline mt-2" data-toggle-button="gain">Lihat lebih banyak...</button>
                        </div>
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <h3 class="font-semibold text-yellow-600 mb-2">Sumur Off <span id="sumur-off-bbls" contenteditable="true">...</span></h3>
                            <ul class="text-sm text-gray-700 space-y-1" id="sumur-off-list" data-list-section="off"></ul>
                            <button onclick="toggleList('off')" class="text-xs text-yellow-400 hover:underline mt-2" data-toggle-button="off">Lihat lebih banyak...</button>
                        </div>
                    </div>
                </div>

                <!-- Top 5 Wells Section -->
                <div class="bg-white rounded-xl shadow-lg p-5">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Sumur dengan Produksi Terbesar (5 Teratas)</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-600 border-collapse">
                            <thead>
                                <tr class="text-sm font-medium text-gray-500 uppercase bg-gray-50 rounded-lg">
                                    <th class="py-3 px-4 rounded-tl-lg">Peringkat</th>
                                    <th class="py-3 px-4">Nama Sumur</th>
                                    <th class="py-3 px-4 text-center">Gross</th>
                                    <th class="py-3 px-4 text-center">Nett</th>
                                    <th class="py-3 px-4 rounded-tr-lg text-center">Gas</th>
                                </tr>
                            </thead>
                            <tbody id="top-wells-table-body" class="divide-y divide-gray-200">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Status Sumur & Produksi Per Struktur -->
                <div class="bg-white rounded-xl shadow-lg p-5">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Detail Tambahan</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                        <div>
                            <h3 class="font-semibold text-lg text-gray-700 mb-2">Produksi per Struktur</h3>
                            <ul class="text-sm text-gray-600 space-y-1" id="produksi-struktur-list">
                                <li contenteditable="true">RTU : 1177 (-31)</li>
                                <li contenteditable="true">KSB : 586 (+42)</li>
                                <li contenteditable="true">KLD : 83 (-3)</li>
                                <li contenteditable="true">SRJ : 0 (0)</li>
                                <li contenteditable="true">SBL : 0 (0)</li>
                                <li contenteditable="true">PPG : 0 (0)</li>
                                <li contenteditable="true">PRP : 0 (0)</li>
                                <li class="font-bold text-gray-800" contenteditable="true">TOTAL : 1846 (+8)</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg text-gray-700 mb-2">Status Sumur</h3>
                            <ul class="text-sm text-gray-600 space-y-1" id="status-sumur-list">
                                <li contenteditable="true">Jumlah Sumur Produksi Minyak : 88</li>
                                <li contenteditable="true">Jumlah Sumur Produksi Gas : 4</li>
                                <li contenteditable="true">Jumlah Sumur Injeksi : 41</li>
                                <li contenteditable="true">Jumlah Sumur Off : 47</li>
                                <li contenteditable="true">Jumlah Sumur Suspended : 822</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Side Content: Progres Proyek -->
            <div class="md:w-1/3 space-y-6">
                <div class="bg-white rounded-xl shadow-lg p-5">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Progres Proyek</h2>
                    <div id="projects-container" class="space-y-4">
                        <!-- Project cards will be injected here by JavaScript -->
                    </div>
                    <!-- Action Buttons for Project Management -->
                    <div class="mt-4 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                         <button id="edit-projects-button" class="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                            Edit Proyek
                        </button>
                        <button id="save-projects-button" class="w-full py-2 px-4 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg shadow-md transition-all hidden">
                            Simpan
                        </button>
                        <button id="cancel-projects-button" class="w-full py-2 px-4 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-lg shadow-md transition-all hidden">
                            Batal
                        </button>
                    </div>
                    <button id="add-project-button" onclick="addProject()" class="mt-2 w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed hidden">
                        Tambah Proyek
                    </button>
                    <button id="delete-all-projects-button" onclick="deleteAllProjects()" class="mt-2 w-full py-2 px-4 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed hidden">
                        Hapus Semua Proyek
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Full Report Editing -->
    <div id="edit-modal" class="modal hidden">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-11/12 max-w-2xl h-5/6 flex flex-col">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Edit Laporan Harian</h2>
            <textarea id="report-editor" class="flex-grow w-full border border-gray-300 rounded-lg p-4 resize-none mb-4 focus:outline-none focus:border-blue-500 text-sm leading-relaxed"></textarea>
            <div class="flex justify-end space-x-4">
                <button onclick="closeFullReportEditor()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors">
                    Tutup
                </button>
                <button onclick="saveFullReport()" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                    Simpan Perubahan
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for messages and confirmations -->
    <div id="message-modal" class="modal hidden">
        <div class="bg-white rounded-xl shadow-lg p-6 max-w-sm text-center">
            <h3 class="text-lg font-semibold text-gray-800 mb-4" id="message-title"></h3>
            <p class="text-sm text-gray-600 mb-6" id="message-content"></p>
            <div class="flex justify-center space-x-4" id="message-buttons">
                 <button onclick="closeMessageModal()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors">
                    Batal
                </button>
                <button onclick="closeMessageModal()" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                    OK
                </button>
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent"></div>
        <p class="ml-4 text-gray-600 text-lg">Memuat data...</p>
    </div>

    <!-- Firebase and main application script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, writeBatch, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        setLogLevel('debug');

        const firebaseConfig = {
            apiKey: "AIzaSyCU4XFIAwkW2uqhwQR7mgWJW9fp6DsMZwM",
            authDomain: "laporanpo.firebaseapp.com",
            projectId: "laporanpo",
            storageBucket: "laporanpo.firebasestorage.app",
            messagingSenderId: "957972296356",
            appId: "1:957972296356:web:3436dcc43a08e4fb44ac31"
        };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        let db;
        let auth;
        let userId;

        window.fullReportText = "";
        window.projectsData = [];
        let isReportLoaded = false;
        let isProjectsLoaded = false;
        let isEditMode = false;
        let localProjectsBuffer = [];

        function safeUpdateText(id, text) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = text;
            } else {
                console.warn(`Elemen dengan ID '${id}' tidak ditemukan. Tidak dapat memperbarui teks.`);
            }
        }

        function safeUpdateStyle(id, property, value) {
            const element = document.getElementById(id);
            if (element) {
                element.style[property] = value;
            } else {
                console.warn(`Elemen dengan ID '${id}' tidak ditemukan. Tidak dapat memperbarui gaya.`);
            }
        }

        function toggleButtons() {
            if (isReportLoaded && isProjectsLoaded) {
                document.getElementById('edit-report-button').disabled = false;
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) loadingOverlay.style.display = 'none';
                console.log("Semua data berhasil dimuat. Tombol-tombol diaktifkan.");
            }
        }
        
        async function initializeFirebaseAndLoadData() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                await signInAnonymously(auth);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Pengguna berhasil login:", userId);
                        safeUpdateText('user-id-display', `ID Pengguna: ${userId.substring(0, 8)}...`);
                        setupFirestoreListeners();
                    } else {
                        console.log("Pengguna tidak login.");
                    }
                });
            } catch (error) {
                console.error("Gagal menginisialisasi Firebase. Pastikan konfigurasi API Key dan pengaturan lainnya benar.", error);
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.querySelector('p').textContent = 'Gagal memuat data. Silakan periksa konsol untuk detail.';
                }
            }
        }

        function setupFirestoreListeners() {
            const reportDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'daily_report_content', 'main_report_doc');
            
            onSnapshot(reportDocRef, (docSnap) => {
                try {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        window.fullReportText = data.reportText || "";
                        safeUpdateText('last-updated-date', data.lastUpdated ? new Date(data.lastUpdated.toDate()).toLocaleString() : 'Sekarang');
                        parseAndDisplayReport(window.fullReportText);
                        console.log("Laporan harian berhasil diperbarui dari Firestore.");
                    } else {
                        console.log("Dokumen laporan tidak ditemukan, membuat dokumen baru.");
                        const initialReport = `Assalamualaikum Warahmatullahi Wabarakatuh

LAPORAN HARIAN PRODUKSI FIELD RANTAU, MINGGU 21 SEPTEMBER 2025.

Produksi RTU Non Recover (std)	= 1,637 bbls (+27 thd kemarin).
Recover/berkala (std)	= 174 bbls (-19 thd kemarin).
Total Prod RTU (std)	= 1,811 bbls ( +8 thd kemarin), 69%.
MTD = 1,747 bopd (66%), YTD = 1,933 bopd (76%).

Total Prod RTU-Aceh (std)	= 1,733 bbls (+22 thd kemarin), 72%.
MTD = 1,669 bopd (69%), YTD = 1,866 bopd (79%).

Total Prod RTU-Sumut (std)	= 78 bbls (-14 thd kemarin), 35%.
MTD = 78 bopd (35%), YTD = 67 bopd (42%).

Sumur Low = -41.5 Bbls, dari 11 sumur
* P-450/6 jam, 15.15 bbl (Water Cut Naik dari 85-89%)
* P-082/5 jam, 13.44 bbl (Water Cut Naik dari 88-97%)
* P-469/4 jam, 10.3 bbl (Fluktuasi Produksi)
* P-347/6 jam, 9.39 bbl (Fluktuasi Produksi)
* P-439/4 jam, 6.07 bbl (Water Cut Naik dari 87-88%)
* KSB-042/6 jam, 4.84 bbl (Water Cut Naik dari 50-67%)
* KSB-065/9 jam, 2.9 bbl (Fluktuasi Produksi)
* P-270/14 jam, 1.78 bbl (Water Cut Naik dari 93-94%)
* P-101/12 jam, 1.24 bbl (Fluktuasi Produksi)
* KSB-061/7 jam, 0.42 bbl (Fluktuasi Produksi)
* KLD-018/8 jam, 0.08 bbl (Water Cut Naik dari 41-42%)

Sumur Gain = +79.07 Bbls, dari 8 sumur
* KSB-044/9 jam, 29.04 bbl (Water Cut Turun dari 48-43%)
* P-417/4 jam, 17.92 bbl (Water Cut Turun dari 67-7%)
* P-445/15 jam, 6.46 bbl (Fluktuasi Produksi)
* P-416/6 jam, 6.43 bbl (Water Cut Turun dari 94-92%)
* P-406/12 jam, 6.37 bbl (Fluktuasi Produksi)
* P-467/4 jam, 6.3 bbl (Fluktuasi Produksi)
* P-383/4 jam, 4.2 bbl (Fluktuasi Produksi)
* P-347/6 jam, 2.35 bbl (Water Cut Turun dari 41-36%)

Sumur Off = -12.89 Bbls, dari 3 Sumur												
Planned Shutdown = -
Unplanned Shutdown = 
* P-419/24 jam, 10.22 bbl PU, Stop ops jam 00.00 s/d Sekarang, (Operasional Rig RTU#02 di P-427)
* P-473/1 jam, 2.67 bbl HPU, Stop ops jam 15.20 s/d 16.20 Wib, (Trouble Fuse putus)
* KSB-009/8 jam, 0.00 bbl HPU, Stop ops jam 11.00 s/d 19.00 Wib, (Program Ganti Elmot)
																
ACTL : 124,775
CRUDE OIL STOCK	: 196,199 bbls.

Produksi Per Struktur:
- RTU  :  1177 (-31)
- SRJ  :     0 (0)
- KSB  :   586 (+42)
- SBL  :     0 (0)
- KLD  :    83 (-3)
- PPG  :     0 (0)
- PRP  :     0 (0)
----------------------
TOTAL  :  1846 (+8)

Prod Gas (Mmscfd) = 2.3329 (-0.0357 Turun dari fluktuasi sumur); 72.2% thd sasaran (3.2303),
Gas MTD September (Mmscfd) = 2.3480 (72.7%) thd sasaran, YTD = 2.4894 (83.5%).

Prod Gas RTU-Aceh (Mmscfd) = 2.1437 (95.2%) thd sasaran 2.2515,
Gas MTD = 2.1434 (95.2%), YTD = 2.2806 (104.1%).

Prod Gas RTU-Sumut (Mmscfd) = 0.1892 (19.3%) thd sasaran 0.9788,
Gas MTD = 0.2063 (21.1%), YTD = 0.2090 (26.4%).

Sepuluh (10) Sumur dengan produksi terbesar:
	       Gross / Nett: Gas
1. KSB-067/ESP : 459 / 182 : 40
2. KSB-044/ESP : 200 / 113 : 34
3. P-347/HPU : 164 / 106 : 0
4. P-406/ESP : 975 / 90 : 18
5. P-458/HPU : 84 / 84 : 0
6. P-459/HPU : 70 / 70 : 0
7. P-417/HPU : 65 / 65 : 0
8. P-467/HPU : 60 / 60 : 0
9. P-445/ESP : 55 / 55 : 0
10. P-469/HPU : 50 / 50 : 0

Status Sumur :	
1. Jumlah Sumur Produksi Minyak : 88
2. Jumlah Sumur Produksi Gas    : 4
3. Jumlah Sumur Injeksi        	: 41
4. Jumlah Sumur Off             : 47
5. Jumlah Sumur Suspended      	: 822 
(643 diketahui / 180 tidak diketahui).`;
                        setDoc(reportDocRef, { reportText: initialReport, lastUpdated: serverTimestamp() });
                    }
                    isReportLoaded = true;
                    toggleButtons();
                } catch (error) {
                    console.error("Kesalahan saat memproses laporan dari Firestore:", error);
                    const loadingOverlay = document.getElementById('loading-overlay');
                    if (loadingOverlay) loadingOverlay.style.display = 'none';
                    window.showMessageModal("Kesalahan", "Gagal memuat laporan. Periksa konsol untuk detail.");
                }
            }, (error) => {
                console.error("Gagal mendapatkan laporan dari Firestore:", error);
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) loadingOverlay.style.display = 'none';
                window.showMessageModal("Kesalahan", "Gagal memuat laporan. Periksa konsol untuk detail.");
            });

            const projectsColRef = collection(db, 'artifacts', appId, 'public', 'data', 'projects');

            onSnapshot(projectsColRef, (snapshot) => {
                try {
                    const fetchedProjects = [];
                    snapshot.forEach(doc => {
                        fetchedProjects.push({ id: doc.id, ...doc.data() });
                    });
                    window.projectsData = fetchedProjects;
                    renderProjectCards(window.projectsData);
                    console.log("Daftar proyek berhasil diperbarui dari Firestore.");
                    isProjectsLoaded = true;
                    toggleButtons();
                } catch (error) {
                    console.error("Kesalahan saat memproses proyek dari Firestore:", error);
                    const loadingOverlay = document.getElementById('loading-overlay');
                    if (loadingOverlay) loadingOverlay.style.display = 'none';
                    window.showMessageModal("Kesalahan", "Gagal memuat proyek. Periksa konsol untuk detail.");
                }
            }, (error) => {
                console.error("Gagal mendapatkan proyek dari Firestore:", error);
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) loadingOverlay.style.display = 'none';
                window.showMessageModal("Kesalahan", "Gagal memuat proyek. Periksa konsol untuk detail.");
            });
        }

        window.parseAndDisplayReport = (reportText) => {
            const lines = reportText.split('\n');
            const data = {};

            const reportTitleMatch = lines.find(line => line.startsWith('LAPORAN HARIAN PRODUKSI FIELD RANTAU,'));
            if (reportTitleMatch) {
                safeUpdateText('report-title-date', reportTitleMatch);
            }
            
            // Temporary storage for MTD/YTD values
            const tempGasData = {};

            lines.forEach(line => {
                const totalProdRtuMatch = line.match(/Total Prod RTU \(std\)\s*=\s*([\d,]*)\s*bbls\s*\((.*?)\)/);
                if (totalProdRtuMatch) {
                    data.totalProdRtu = totalProdRtuMatch[1];
                    data.totalProdRtuChange = `(${totalProdRtuMatch[2].trim()})`;
                }

                const prodRtuAcehMatch = line.match(/Total Prod RTU-Aceh \(std\)\s*=\s*([\d,]*)\s*bbls\s*\((.*?)\)/);
                if (prodRtuAcehMatch) {
                    data.prodRtuAceh = prodRtuAcehMatch[1];
                    data.prodRtuAcehChange = `(${prodRtuAcehMatch[2].trim()})`;
                }

                const prodRtuSumutMatch = line.match(/Total Prod RTU-Sumut \(std\)\s*=\s*([\d,]*)\s*bbls\s*\((.*?)\)/);
                if (prodRtuSumutMatch) {
                    data.prodRtuSumut = prodRtuSumutMatch[1];
                    data.prodRtuSumutChange = `(${prodRtuSumutMatch[2].trim()})`;
                }

                const crudeStockMatch = line.match(/CRUDE OIL STOCK\s*:\s*([\d,]*)\s*bbls/);
                if (crudeStockMatch) {
                    data.crudeOilStock = crudeStockMatch[1];
                }
                
                const prodGasTotalMatch = line.match(/Prod Gas \(Mmscfd\) = ([\d\.]+) \((.*?)\);/);
                if (prodGasTotalMatch) {
                    data.prodGasTotal = prodGasTotalMatch[1];
                    data.prodGasTotalChange = `(${prodGasTotalMatch[2].trim()})`;
                }

                const prodGasAcehMatch = line.match(/Prod Gas RTU-Aceh \(Mmscfd\) = ([\d\.]+) \((\d+\.\d+%)\)/);
                if (prodGasAcehMatch) {
                    data.prodGasAceh = prodGasAcehMatch[1];
                    data.prodGasAcehPercent = `(${prodGasAcehMatch[2]})`;
                }
                
                const prodGasSumutMatch = line.match(/Prod Gas RTU-Sumut \(Mmscfd\) = ([\d\.]+) \((\d+\.\d+%)\)/);
                if (prodGasSumutMatch) {
                    data.prodGasSumut = prodGasSumutMatch[1];
                    data.prodGasSumutPercent = `(${prodGasSumutMatch[2]})`;
                }
                
                const gasMtdYtdTotalMatch = line.match(/Gas MTD September.*?= ([\d\.]+) \((.*?)\), YTD = ([\d\.]+) \((.*?)\)/);
                if (gasMtdYtdTotalMatch) {
                    tempGasData.totalMtd = `${gasMtdYtdTotalMatch[1]} (${gasMtdYtdTotalMatch[2]})`;
                    tempGasData.totalYtd = `${gasMtdYtdTotalMatch[3]} (${gasMtdYtdTotalMatch[4]})`;
                }

                const gasMtdYtdAcehMatch = line.match(/Gas MTD = ([\d\.]+) \((.*?)\), YTD = ([\d\.]+) \((.*?)\)/);
                if (gasMtdYtdAcehMatch && !tempGasData.acehMtd) { // ensure we only capture the first match for Aceh
                    tempGasData.acehMtd = `${gasMtdYtdAcehMatch[1]} (${gasMtdYtdAcehMatch[2]})`;
                    tempGasData.acehYtd = `${gasMtdYtdAcehMatch[3]} (${gasMtdYtdAcehMatch[4]})`;
                }
                
                const gasMtdYtdSumutMatch = line.match(/Gas MTD = ([\d\.]+) \((.*?)\), YTD = ([\d\.]+) \((.*?)\)/);
                if (gasMtdYtdSumutMatch && tempGasData.acehMtd && !tempGasData.sumutMtd) { // capture the second match for Sumut
                     tempGasData.sumutMtd = `${gasMtdYtdSumutMatch[1]} (${gasMtdYtdSumutMatch[2]})`;
                     tempGasData.sumutYtd = `${gasMtdYtdSumutMatch[3]} (${gasMtdYtdSumutMatch[4]})`;
                }
                
                const sumurLowMatch = line.match(/Sumur Low = (.*)/);
                if (sumurLowMatch) {
                    data.sumurLow = sumurLowMatch[1].trim();
                }

                const sumurGainMatch = line.match(/Sumur Gain = (.*)/);
                if (sumurGainMatch) {
                    data.sumurGain = sumurGainMatch[1].trim();
                }

                const sumurOffMatch = line.match(/Sumur Off = (.*)/);
                if (sumurOffMatch) {
                    data.sumurOff = sumurOffMatch[1].trim();
                }
            });

            // Update Oil Metrics
            safeUpdateText('total-prod-rtu', data.totalProdRtu);
            safeUpdateText('total-prod-rtu-change', data.totalProdRtuChange);
            safeUpdateText('prod-rtu-aceh', data.prodRtuAceh);
            safeUpdateText('prod-rtu-aceh-change', data.prodRtuAcehChange);
            safeUpdateText('prod-rtu-sumut', data.prodRtuSumut);
            safeUpdateText('prod-rtu-sumut-change', data.prodRtuSumutChange);
            safeUpdateText('crude-oil-stock', data.crudeOilStock);
            
            // Update Gas Metrics
            safeUpdateText('prod-gas-total', data.prodGasTotal);
            safeUpdateText('prod-gas-total-change', data.prodGasTotalChange);
            safeUpdateText('prod-gas-mtd', tempGasData.totalMtd);
            safeUpdateText('prod-gas-ytd', tempGasData.totalYtd);
            
            safeUpdateText('prod-gas-aceh', data.prodGasAceh);
            safeUpdateText('prod-gas-aceh-percent', data.prodGasAcehPercent);
            safeUpdateText('prod-gas-aceh-mtd', tempGasData.acehMtd);
            safeUpdateText('prod-gas-aceh-ytd', tempGasData.acehYtd);
            
            safeUpdateText('prod-gas-sumut', data.prodGasSumut);
            safeUpdateText('prod-gas-sumut-percent', data.prodGasSumutPercent);
            safeUpdateText('prod-gas-sumut-mtd', tempGasData.sumutMtd);
            safeUpdateText('prod-gas-sumut-ytd', tempGasData.sumutYtd);
            
            safeUpdateText('sumur-low-bbls', data.sumurLow);
            safeUpdateText('sumur-gain-bbls', data.sumurGain);
            safeUpdateText('sumur-off-bbls', data.sumurOff);
            
            window.updateList('low', reportText, false);
            window.updateList('gain', reportText, false);
            window.updateList('off', reportText, false);

            parseAndRenderTopWells(reportText);
        };
        
        // Fungsi baru untuk memparsing dan merender tabel 5 sumur teratas
        function parseAndRenderTopWells(reportText) {
            const tableBody = document.getElementById('top-wells-table-body');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            const lines = reportText.split('\n');
            // Mengubah pencarian judul dari "5 teratas" ke "10 teratas"
            const startIndex = lines.findIndex(line => line.includes('Sepuluh (10) Sumur dengan produksi terbesar:'));

            if (startIndex === -1) {
                console.warn("Bagian 'Sepuluh (10) Sumur dengan produksi terbesar' tidak ditemukan.");
                return;
            }
            
            const wellsData = [];
            // Regex yang lebih kuat untuk menangkap data
            const wellRegex = /^\s*(\d+)\.\s*(.*?)\s*:\s*([\d\s]+)\s*\/\s*([\d\s]+)\s*:\s*([\d\s]+)\s*$/;
            
            // Loop untuk 5 baris pertama saja
            for (let i = startIndex + 2; i < startIndex + 7 && i < lines.length; i++) {
                const line = lines[i];
                const match = line.match(wellRegex);
                if (match) {
                    const [, rank, name, gross, nett, gas] = match;
                    wellsData.push({
                        name: name.trim(),
                        gross: gross.trim(),
                        nett: nett.trim(),
                        gas: gas.trim()
                    });
                }
            }

            wellsData.forEach((well, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors duration-200';
                row.innerHTML = `
                    <td class="py-3 px-4 font-semibold text-gray-700">${index + 1}</td>
                    <td class="py-3 px-4" contenteditable="true">${well.name}</td>
                    <td class="py-3 px-4 text-center" contenteditable="true">${well.gross}</td>
                    <td class="py-3 px-4 text-center" contenteditable="true">${well.nett}</td>
                    <td class="py-3 px-4 text-center" contenteditable="true">${well.gas}</td>
                `;
                tableBody.appendChild(row);
            });
        }


        window.initializeFirebaseAndLoadData = initializeFirebaseAndLoadData;
        window.db = db;
        window.auth = auth;
        window.userId = userId;
        window.isEditMode = isEditMode;
        window.localProjectsBuffer = localProjectsBuffer;

        function createProjectCard(project) {
            const projectCard = document.createElement('div');
            projectCard.className = 'bg-gray-50 border border-gray-200 rounded-lg p-4 shadow-sm space-y-2 relative';
            projectCard.dataset.id = project.id;
            
            const content = isEditMode ? `
                <button onclick="deleteProject('${project.id}')" class="absolute top-2 right-2 text-red-500 hover:text-red-700 transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" />
                    </svg>
                </button>
                <input type="text" class="font-semibold text-gray-800 w-full pr-8 bg-transparent focus:outline-none" value="${project.name}" oninput="updateLocalProject('${project.id}', 'name', this.value)">
                <div class="text-xs text-gray-500">
                    <span class="font-medium">Tim:</span>
                    <input type="text" class="w-full bg-transparent focus:outline-none" value="${project.team}" oninput="updateLocalProject('${project.id}', 'team', this.value)">
                </div>
                <div class="text-xs text-gray-500">
                    <span class="font-medium">Jatuh Tempo:</span>
                    <input type="date" class="w-full bg-transparent focus:outline-none" value="${project.dueDate}" oninput="updateLocalProject('${project.id}', 'dueDate', this.value)">
                </div>
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-xs font-medium text-gray-500">Progres:</span>
                        <span class="text-sm font-bold text-gray-700" data-progress-value>${project.progress}%</span>
                    </div>
                    <input type="range" min="0" max="100" value="${project.progress}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateLocalProgress('${project.id}', this.value, this)" />
                </div>
            ` : `
                <h3 class="font-semibold text-gray-800 pr-8">${project.name}</h3>
                <p class="text-xs text-gray-500">
                    <span class="font-medium">Tim:</span> <span>${project.team}</span>
                </p>
                <p class="text-xs text-gray-500">
                    <span class="font-medium">Jatuh Tempo:</span> <span>${project.dueDate}</span>
                </p>
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-xs font-medium text-gray-500">Progres:</span>
                        <span class="text-sm font-bold text-gray-700" data-progress-value>${project.progress}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${project.progress}%;"></div>
                    </div>
                </div>
            `;
            
            projectCard.innerHTML = content;
            return projectCard;
        }

        window.renderProjectCards = (projects) => {
            const projectsContainer = document.getElementById('projects-container');
            if (projectsContainer) {
                projectsContainer.innerHTML = '';
                projects.forEach(project => {
                    projectsContainer.appendChild(createProjectCard(project));
                });
            }
        };

        window.updateLocalProject = (id, field, value) => {
            const project = localProjectsBuffer.find(p => p.id === id);
            if (project) {
                project[field] = value;
            }
        };

        window.updateLocalProgress = (id, value, element) => {
            const valueSpan = element.closest('div').querySelector('[data-progress-value]');
            valueSpan.textContent = `${value}%`;
            updateLocalProject(id, 'progress', parseInt(value));
        };
        
        // New functions for edit mode management
        function toggleProjectEditMode(isEditing) {
            isEditMode = isEditing;
            const editBtn = document.getElementById('edit-projects-button');
            const saveBtn = document.getElementById('save-projects-button');
            const cancelBtn = document.getElementById('cancel-projects-button');
            const addBtn = document.getElementById('add-project-button');
            const deleteBtn = document.getElementById('delete-all-projects-button');
            
            if (isEditing) {
                localProjectsBuffer = JSON.parse(JSON.stringify(window.projectsData));
                renderProjectCards(localProjectsBuffer);
                editBtn.classList.add('hidden');
                saveBtn.classList.remove('hidden');
                cancelBtn.classList.remove('hidden');
                addBtn.classList.remove('hidden');
                deleteBtn.classList.remove('hidden');
            } else {
                renderProjectCards(window.projectsData);
                editBtn.classList.remove('hidden');
                saveBtn.classList.add('hidden');
                cancelBtn.classList.add('hidden');
                addBtn.classList.add('hidden');
                deleteBtn.classList.add('hidden');
            }
        }

        async function saveProjects() {
            if (!db) {
                window.showMessageModal("Kesalahan", "Database tidak siap. Coba lagi dalam beberapa detik.");
                return;
            }
            const batch = writeBatch(db);
            const projectsColRef = collection(db, 'artifacts', appId, 'public', 'data', 'projects');

            // Handle updates and additions
            localProjectsBuffer.forEach(project => {
                const docRef = doc(projectsColRef, project.id);
                // We use set with merge: true to handle both new and existing documents
                batch.set(docRef, project, { merge: true });
            });
            
            // Handle deletions (find projects in original data but not in buffer)
            const idsToDelete = window.projectsData.filter(
                original => !localProjectsBuffer.some(updated => updated.id === original.id)
            ).map(p => p.id);

            idsToDelete.forEach(id => {
                const docRef = doc(projectsColRef, id);
                batch.delete(docRef);
            });

            try {
                await batch.commit();
                console.log("Proyek berhasil disimpan.");
                window.showMessageModal("Berhasil", "Semua perubahan proyek berhasil disimpan!");
            } catch (e) {
                console.error("Gagal menyimpan proyek:", e);
                window.showMessageModal("Kesalahan", `Gagal menyimpan proyek: ${e.message}`);
            }
            toggleProjectEditMode(false);
        }

        function cancelProjects() {
            localProjectsBuffer = JSON.parse(JSON.stringify(window.projectsData));
            toggleProjectEditMode(false);
            window.showMessageModal("Dibatalkan", "Perubahan proyek telah dibatalkan.");
        }

        window.addProject = async () => {
             const newProjectId = `new-${Date.now()}`;
            const newProject = {
                id: newProjectId,
                name: 'Proyek Baru',
                team: 'Tim Baru',
                dueDate: new Date().toISOString().substring(0, 10),
                progress: 0,
                createdAt: new Date().toISOString()
            };
            localProjectsBuffer.push(newProject);
            renderProjectCards(localProjectsBuffer);
            console.log("Proyek baru ditambahkan ke buffer lokal.");
        };

        window.deleteProject = (id) => {
            const index = localProjectsBuffer.findIndex(p => p.id === id);
            if (index > -1) {
                localProjectsBuffer.splice(index, 1);
                renderProjectCards(localProjectsBuffer);
                console.log(`Proyek dengan ID ${id} dihapus dari buffer lokal.`);
            }
        };

        window.deleteAllProjects = () => {
            window.showMessageModal("Konfirmasi", "Apakah Anda yakin ingin menghapus semua proyek?", true, () => {
                localProjectsBuffer = [];
                renderProjectCards(localProjectsBuffer);
                console.log("Semua proyek dihapus dari buffer lokal.");
            });
        };
        
        window.showMessageModal = (title, content, isConfirm = false, onConfirm = null) => {
            const modal = document.getElementById('message-modal');
            const messageButtons = document.getElementById('message-buttons');
            if (!modal || !messageButtons) return;
            
            safeUpdateText('message-title', title);
            safeUpdateText('message-content', content);
            
            messageButtons.innerHTML = '';
            
            if (isConfirm) {
                const confirmBtn = document.createElement('button');
                confirmBtn.onclick = () => {
                    if (onConfirm) onConfirm();
                    closeMessageModal();
                };
                confirmBtn.className = 'px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors';
                confirmBtn.textContent = 'OK';
                
                const cancelBtn = document.createElement('button');
                cancelBtn.onclick = closeMessageModal;
                cancelBtn.className = 'px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors';
                cancelBtn.textContent = 'Batal';
                
                messageButtons.appendChild(cancelBtn);
                messageButtons.appendChild(confirmBtn);
            } else {
                const okBtn = document.createElement('button');
                okBtn.onclick = closeMessageModal;
                okBtn.className = 'w-full px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors';
                okBtn.textContent = 'OK';
                messageButtons.appendChild(okBtn);
            }

            modal.classList.remove('hidden');
        };

        window.closeMessageModal = () => {
            const modal = document.getElementById('message-modal');
            if (modal) modal.classList.add('hidden');
        };

        window.openFullReportEditor = () => {
            const modal = document.getElementById('edit-modal');
            const editor = document.getElementById('report-editor');
            if (modal && editor) {
                editor.value = window.fullReportText;
                modal.classList.remove('hidden');
            }
        };

        window.closeFullReportEditor = () => {
            const modal = document.getElementById('edit-modal');
            if (modal) modal.classList.add('hidden');
        };

        window.saveFullReport = async () => {
            if (!db) {
                console.error("Database tidak siap. Tidak dapat menyimpan laporan.");
                window.showMessageModal("Gagal", "Database tidak siap. Coba lagi dalam beberapa detik.");
                return;
            }
            const editor = document.getElementById('report-editor');
            if (!editor) return;
            
            const newText = editor.value;
            const reportDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'daily_report_content', 'main_report_doc');
            
            try {
                await setDoc(reportDocRef, { reportText: newText, lastUpdated: serverTimestamp() });
                console.log("Laporan berhasil disimpan ke Firestore.");
                window.closeFullReportEditor();
            } catch (e) {
                console.error("Gagal menyimpan laporan:", e);
                window.showMessageModal("Kesalahan", "Gagal menyimpan laporan. Silakan periksa konsol untuk detail.");
            }
        };
        
        window.updateProgressBar = (id, percentage) => {
            const fillElement = document.getElementById(id);
            if (fillElement) {
                safeUpdateStyle(id, 'width', `${Math.min(100, percentage)}%`);
            }
        };

        window.updateList = (section, reportText, isExpanded) => {
            const ulElement = document.getElementById(`sumur-${section}-list`);
            const button = document.querySelector(`[data-toggle-button="${section}"]`);
            if (!ulElement) return;

            const listRegex = {
                low: { start: /Sumur Low = (.*)/, end: /Sumur Gain =/ },
                gain: { start: /Sumur Gain = (.*)/, end: /Sumur Off =/ },
                off: { start: /Sumur Off = (.*)/, end: /ACTL :/ },
            };
            const initialVisibleItems = 5;

            const regexStart = listRegex[section].start;
            const regexEnd = listRegex[section].end;

            const listStartMatch = reportText.match(regexStart);
            const listEndMatch = reportText.match(regexEnd);
            
            if (!listStartMatch || !listEndMatch) {
                ulElement.innerHTML = '';
                if (button) button.classList.add('hidden');
                return;
            }

            const startIndex = reportText.indexOf(listStartMatch[0]) + listStartMatch[0].length;
            const endIndex = reportText.indexOf(listEndMatch[0], startIndex);
            const listContent = reportText.substring(startIndex, endIndex).trim();
            const allLines = listContent.split('\n').filter(line => line.trim().startsWith('*')).map(line => line.substring(1).trim());

            ulElement.innerHTML = '';
            
            let linesToDisplay;
            if (isExpanded) {
                linesToDisplay = allLines;
                if (button) button.textContent = 'Lihat lebih sedikit...';
            } else {
                linesToDisplay = allLines.slice(0, initialVisibleItems);
                if (button) button.textContent = 'Lihat lebih banyak...';
            }
            
            linesToDisplay.forEach((line, index) => {
                const li = document.createElement('li');
                li.textContent = line;
                li.setAttribute('contenteditable', 'true');
                if (index < linesToDisplay.length - 1) {
                     li.classList.add('border-b', 'border-gray-200', 'pb-2', 'mb-2');
                }
                ulElement.appendChild(li);
            });

            if (button) {
                if (allLines.length <= initialVisibleItems) {
                    button.classList.add('hidden');
                } else {
                    button.classList.remove('hidden');
                }
            }

            ulElement.dataset.expanded = isExpanded;
        };

        window.toggleList = (section) => {
            const ulElement = document.getElementById(`sumur-${section}-list`);
            if (ulElement) {
                const isExpanded = ulElement.dataset.expanded === 'true';
                window.updateList(section, window.fullReportText, !isExpanded);
            }
        };
        
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('edit-projects-button').onclick = () => toggleProjectEditMode(true);
            document.getElementById('save-projects-button').onclick = saveProjects;
            document.getElementById('cancel-projects-button').onclick = cancelProjects;
            window.initializeFirebaseAndLoadData();
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) loadingOverlay.style.display = 'flex';
        });
    </script>
</body>
</html>
